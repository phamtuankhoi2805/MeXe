<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VinFast Admin | Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin.css}" href="/css/admin.css">
</head>

<body class="admin-body">
    <div class="admin-shell">
        <div th:replace="~{admin/fragments/sidebar :: sidebar(${adminSection})}"></div>

        <div class="admin-main">
            <header class="admin-topbar">
                <div>
                    <p class="eyebrow">Dashboard</p>
                    <h1>Vận hành hệ thống xe máy điện</h1>
                </div>
                <div class="admin-topbar__actions">
                    <button class="adm-btn adm-btn--ghost">Tải báo cáo</button>
                    <button class="adm-btn adm-btn--primary">Tạo chiến dịch</button>
                </div>
            </header>

            <section class="admin-content">
                <div class="admin-grid admin-grid--stats">
                    <article>
                        <small>Tổng đơn hàng</small>
                        <strong>1.248</strong>
                        <span>+18% so với tuần trước</span>
                    </article>
                    <article>
                        <small>Xe bàn giao</small>
                        <strong>942</strong>
                        <span>85% hoàn thành đúng hẹn</span>
                    </article>
                    <article>
                        <small>Khách đăng ký lái thử</small>
                        <strong>312</strong>
                        <span>42 showrooms đã xác nhận</span>
                    </article>
                    <article>
                        <small>Tỷ lệ thuê pin</small>
                        <strong>67%</strong>
                        <span>Gói linh hoạt chiếm 54%</span>
                    </article>
                </div>

                <div class="admin-grid">
                    <article class="admin-card chart-card">
                        <header>
                            <h2>Doanh thu 7 ngày qua</h2>
                        </header>
                        <div style="height: 300px;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </article>
                    <article class="admin-card chart-card">
                        <header>
                            <h2>Trạng thái đơn hàng</h2>
                        </header>
                        <div style="height: 300px; display: flex; justify-content: center;">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </article>
                </div>

                <div class="admin-card">
                    <header>
                        <h2>Đơn hàng gần nhất</h2>
                        <a th:href="@{/admin/don-hang}">Xem tất cả</a>
                        <div class="table-scroll">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Mã đơn</th>
                                        <th>Khách hàng</th>
                                        <th>Tổng tiền</th>
                                        <th>Trạng thái</th>
                                        <th>Ngày</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="order : ${recentOrders}">
                                        <td th:text="${order.orderCode}">VF-21084</td>
                                        <td th:text="${order.address.fullName}">Phan
                                            Minh An</td>
                                        <td
                                            th:text="${#numbers.formatDecimal(order.total, 0, 'COMMA', 0, 'POINT')} + ' ₫'">
                                            Feliz 2025</td>
                                        <td>
                                            <span class="tag"
                                                th:classappend="${order.orderStatus.name() == 'DELIVERED' ? 'tag--success' : (order.orderStatus.name() == 'CANCELLED' ? 'tag--danger' : 'tag--warning')}"
                                                th:text="${order.orderStatus}">Đang
                                                giao</span>
                                        </td>
                                        <td th:text="${#temporals.format(order.createdAt, 'dd/MM')}">
                                            15/11</td>
                                    </tr>
                                    <tr th:if="${recentOrders.empty}">
                                        <td colspan="5" style="text-align: center;">Chưa
                                            có đơn hàng nào</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                </div>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        // Revenue Chart
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        const revenueLabels = /*[[${revenueLabels}]]*/[];
        const revenueData = /*[[${revenueData}]]*/[];

        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: revenueLabels,
                datasets: [{
                    label: 'Doanh thu (VNĐ)',
                    data: revenueData,
                    borderColor: '#0056ff',
                    backgroundColor: 'rgba(0, 86, 255, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value) {
                                return value.toLocaleString('vi-VN') + ' ₫';
                            }
                        }
                    }
                }
            }
        });

        // Status Chart
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        const statusData = /*[[${orderStatusData}]]*/[];

        new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Chờ xử lý', 'Đang giao', 'Hoàn thành', 'Đã hủy'],
                datasets: [{
                    data: statusData,
                    backgroundColor: [
                        '#f59e0b', // Warning/Pending
                        '#3b82f6', // Info/Shipping
                        '#10b981', // Success/Delivered
                        '#ef4444'  // Danger/Cancelled
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    </script>
</body>

</html>