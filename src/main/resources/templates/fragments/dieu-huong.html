<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="vi">

<body>
    <header class="vf-header" th:fragment="thanhDieuHuong">
        <div class="vf-container vf-header-inner">
            <a th:href="@{/}" class="vf-logo" aria-label="Trang chủ VinFast">
                <img src="/image/VinFast-logo.svg" alt="VinFast logo" width="120" height="32">
            </a>

            <button class="vf-menu-toggle" type="button" aria-label="Mở menu" aria-expanded="false"
                aria-controls="vfMainNav">
                <span></span>
            </button>

            <nav class="vf-nav" id="vfMainNav" aria-label="Điều hướng chính">
                <ul class="vf-nav__list">
                    <li class="vf-nav__item has-submenu" th:classappend="${trangDangChon == 'san-pham'} ? ' is-active'">
                        <button class="vf-nav__toggle" type="button" aria-expanded="false">Sản phẩm</button>
                        <div class="vf-submenu" role="menu">
                            <div class="vf-submenu__column">
                                <span class="vf-submenu__title">Cao cấp</span>
                                <th:block th:if="${navProducts != null && navProducts['caoCap'] != null}">
                                    <a th:each="product : ${navProducts['caoCap']}"
                                        th:href="@{'/san-pham/' + ${product.slug}}" class="vf-submenu__link"
                                        th:text="${product.name}">
                                        Sản phẩm
                                    </a>
                                </th:block>
                                <th:block
                                    th:if="${navProducts == null || navProducts['caoCap'] == null || navProducts['caoCap'].isEmpty()}">
                                    <a href="#" class="vf-submenu__link">VF DrgnFly eBike</a>
                                    <a th:href="@{/san-pham/vero-x}" class="vf-submenu__link">Vero X 2025</a>
                                    <a href="#" class="vf-submenu__link">Vento S</a>
                                </th:block>
                            </div>
                            <div class="vf-submenu__column">
                                <span class="vf-submenu__title">Trung cấp</span>
                                <th:block th:if="${navProducts != null && navProducts['trungCap'] != null}">
                                    <a th:each="product : ${navProducts['trungCap']}"
                                        th:href="@{'/san-pham/' + ${product.slug}}" class="vf-submenu__link"
                                        th:text="${product.name}">
                                        Sản phẩm
                                    </a>
                                </th:block>
                                <th:block
                                    th:if="${navProducts == null || navProducts['trungCap'] == null || navProducts['trungCap'].isEmpty()}">
                                    <a href="#" class="vf-submenu__link">Feliz 2025</a>
                                    <a href="#" class="vf-submenu__link">Feliz S</a>
                                    <a href="#" class="vf-submenu__link">Feliz Lite</a>
                                </th:block>
                            </div>
                            <div class="vf-submenu__column">
                                <span class="vf-submenu__title">Phổ thông</span>
                                <th:block th:if="${navProducts != null && navProducts['phoThong'] != null}">
                                    <a th:each="product : ${navProducts['phoThong']}"
                                        th:href="@{'/san-pham/' + ${product.slug}}" class="vf-submenu__link"
                                        th:text="${product.name}">
                                        Sản phẩm
                                    </a>
                                </th:block>
                                <th:block
                                    th:if="${navProducts == null || navProducts['phoThong'] == null || navProducts['phoThong'].isEmpty()}">
                                    <a href="#" class="vf-submenu__link">Feliz Neo</a>
                                    <a href="#" class="vf-submenu__link">Klara S2</a>
                                    <a href="#" class="vf-submenu__link">Klara Neo</a>
                                </th:block>
                            </div>
                            <div class="vf-submenu__cta">
                                <h4>Ưu đãi tháng 11</h4>
                                <p>Giảm thêm 2 triệu khi đặt cọc online, tặng 12 tháng bảo hành mở rộng.</p>
                                <a href="#" class="vf-btn vf-btn--primary">Đặt cọc ngay</a>
                            </div>
                        </div>
                    </li>
                    <li class="vf-nav__item" th:classappend="${trangDangChon == 'phu-kien'} ? ' is-active'">
                        <a th:href="@{/phu-kien}" class="vf-nav__link">Phụ kiện xe</a>
                    </li>
                    <li class="vf-nav__item has-submenu" th:classappend="${trangDangChon == 'dich-vu'} ? ' is-active'">
                        <button class="vf-nav__toggle" type="button" aria-expanded="false">Dịch vụ</button>
                        <div class="vf-submenu" role="menu">
                            <div class="vf-submenu__column">
                                <a th:href="@{/dich-vu-pin}" class="vf-submenu__link">Dịch vụ pin</a>
                                <a th:href="@{/dich-vu-hau-mai}" class="vf-submenu__link">Dịch vụ hậu mãi</a>
                            </div>
                        </div>
                    </li>
                    <li class="vf-nav__item" th:classappend="${trangDangChon == 'gioi-thieu'} ? ' is-active'">
                        <a th:href="@{/ve-chung-toi}" class="vf-nav__link">Về VinFast</a>
                    </li>
                    <li class="vf-nav__item" th:classappend="${trangDangChon == 'tin-tuc'} ? ' is-active'">
                        <a th:href="@{/tin-tuc}" class="vf-nav__link">Tin tức</a>
                    </li>
                </ul>
            </nav>

            <div class="vf-actions">
                <!-- Search Button - Icon Only -->
                <button class="vf-icon-only vf-search-toggle" type="button" aria-label="Tìm kiếm" id="searchToggle">
                    <svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
                        <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2" />
                        <path d="m20 20-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" />
                    </svg>
                </button>

                <!-- Search Box (hidden by default) -->
                <div class="vf-search-box" id="searchBox" style="display: none;">
                    <form th:action="@{/tim-kiem}" method="get" class="vf-search-form">
                        <input type="text" name="keyword" placeholder="Tìm kiếm sản phẩm..." class="vf-search-input"
                            id="searchInput" autocomplete="off">
                        <button type="submit" class="vf-search-submit" aria-label="Tìm kiếm">
                            <svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
                                <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2" />
                                <path d="m20 20-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" />
                            </svg>
                        </button>
                    </form>
                </div>

                <!-- Account Button - Icon Only with Dropdown -->
                <div class="vf-account-dropdown"
                    th:if="${#authentication != null && #authentication.isAuthenticated() && #authentication.name != 'anonymousUser'}">
                    <button class="vf-icon-only vf-account-button vf-account-button--logged-in" type="button"
                        aria-label="Tài khoản" id="accountToggle">
                        <svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20" fill="currentColor">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                    </button>
                    <div class="vf-account-menu" id="accountMenu">
                        <a th:href="@{/tai-khoan}" class="vf-account-menu-item">
                            <svg viewBox="0 0 24 24" width="18" height="18">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" fill="none" stroke="currentColor"
                                    stroke-width="2" />
                                <circle cx="12" cy="7" r="4" fill="none" stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span>Thông tin tài khoản</span>
                        </a>
                        <a th:href="@{/tai-khoan/don-hang}" class="vf-account-menu-item">
                            <svg viewBox="0 0 24 24" width="18" height="18">
                                <path
                                    d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            <span>Đơn hàng của tôi</span>
                        </a>
                        <a th:href="@{/admin}" class="vf-account-menu-item" sec:authorize="hasAuthority('ROLE_ADMIN')">
                            <svg viewBox="0 0 24 24" width="18" height="18">
                                <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                            </svg>
                            <span>Trang quản trị</span>
                        </a>
                        <a th:href="@{/logout}" class="vf-account-menu-item vf-account-menu-item--logout">
                            <svg viewBox="0 0 24 24" width="18" height="18">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" fill="none" stroke="currentColor"
                                    stroke-width="2" />
                                <polyline points="16 17 21 12 16 7" fill="none" stroke="currentColor"
                                    stroke-width="2" />
                                <line x1="21" y1="12" x2="9" y2="12" fill="none" stroke="currentColor"
                                    stroke-width="2" />
                            </svg>
                            <span>Đăng xuất</span>
                        </a>
                    </div>
                </div>

                <!-- Account Button - Not logged in -->
                <a th:if="${#authentication == null || !#authentication.isAuthenticated() || #authentication.name == 'anonymousUser'}"
                    th:href="@{/dang-ky/tai-khoan}" class="vf-icon-only vf-account-button" aria-label="Tài khoản">
                    <svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <circle cx="12" cy="7" r="4" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </a>

                <!-- Cart Button - Icon Only -->
                <a th:href="@{/gio-hang}" class="vf-icon-only" aria-label="Giỏ hàng">
                    <svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
                        <path d="M7.5 6h-3l-1 2v1h2l2.5 8.5h10.5l2.5-9.5h-13z" fill="none" stroke="currentColor"
                            stroke-width="1.4" stroke-linejoin="round" />
                        <circle cx="10.5" cy="19.5" r="1.2" fill="currentColor" />
                        <circle cx="16.5" cy="19.5" r="1.2" fill="currentColor" />
                    </svg>
                </a>

                <!-- Test Drive Button - Icon Only -->
                <a th:href="@{/dang-ky/lai-thu}" class="vf-icon-only" aria-label="Đăng ký lái thử">
                    <svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
                        <path d="M5 12h14M12 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5" />
                    </svg>
                </a>
            </div>
        </div>
    </header>
</body>

</html>